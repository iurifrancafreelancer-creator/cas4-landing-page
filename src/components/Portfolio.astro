---
// Array de projetos com imagem em alta resolução, miniatura e legenda persuasiva.
const projects = [
  {
    src: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=1600&auto=format&fit=crop",
    thumb: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=600&auto=format&fit=crop",
    caption: "Piso Vinílico Amadeirado - Conforto térmico e visual impecável para salas amplas."
  },
  {
    src: "https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?q=80&w=1600&auto=format&fit=crop",
    thumb: "https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?q=80&w=600&auto=format&fit=crop",
    caption: "Instalação de Persianas Sob Medida - Privacidade e controle de luz na medida certa."
  },
  {
    src: "https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?q=80&w=1600&auto=format&fit=crop",
    thumb: "https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?q=80&w=600&auto=format&fit=crop",
    caption: "Acabamento de Rodapés - O detalhe que transforma e valoriza o ambiente."
  },
  {
    src: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=1600&auto=format&fit=crop",
    thumb: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=600&auto=format&fit=crop",
    caption: "Piso Laminado em Quarto Casal - Instalação rápida, silenciosa e sem sujeira."
  }
];
---
<section class="py-20 bg-white" id="portfolio">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col md:flex-row justify-between items-end mb-12">
      <div class="max-w-2xl">
        <h2 class="text-2xl md:text-4xl font-bold text-[#0A2F5C] mb-4 md:mb-6 leading-tight">
          Nosso padrão de entrega
        </h2>
        <p class="text-base md:text-lg text-slate-600 mb-6 leading-relaxed">
          Toque nas imagens para ampliar e ver os detalhes do nosso capricho.
        </p>
      </div>
      <a href="https://wa.me/55SEUNUMERO" target="_blank" class="hidden md:inline-flex mt-4 md:mt-0 text-[#B28D42] font-bold hover:text-[#0A2F5C] transition-colors items-center">
        Quero esse resultado na minha casa <span class="ml-2">→</span>
      </a>
    </div>

    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4">
      {projects.map((project, index) => (
        <button 
          class="gallery-trigger relative group overflow-hidden rounded-xl cursor-pointer focus:outline-none focus:ring-4 focus:ring-[#B28D42]/50 w-full text-left"
          data-src={project.src}
          data-caption={project.caption}
          aria-label={`Ampliar imagem: ${project.caption}`}
        >
          <img 
            src={project.thumb} 
            alt={project.caption} 
            class="w-full h-40 md:h-80 object-cover transform group-hover:scale-110 transition-transform duration-700"
            loading="lazy"
          />
          
          <div class="absolute inset-0 bg-[#0A2F5C]/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
            <svg class="w-10 h-10 text-white drop-shadow-md" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path></svg>
          </div>
        </button>
      ))}
    </div>
  </div>
</section>

<dialog id="image-lightbox" class="bg-transparent m-auto p-0 max-w-full max-h-full w-full h-full backdrop:bg-[#051830]/95 backdrop:backdrop-blur-sm fixed inset-0 z-[100] overflow-hidden">
  
  <div class="relative w-full h-full flex flex-col items-center justify-center p-4 sm:p-8">
    
    <button id="close-lightbox" class="absolute top-4 right-4 sm:top-8 sm:right-8 text-white/70 hover:text-white transition-colors p-2 z-[110] focus:outline-none" aria-label="Fechar galeria">
      <svg class="w-10 h-10 drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
    </button>
    
    <div class="relative max-w-5xl w-full flex-1 flex items-center justify-center">
      <img id="lightbox-img" src="" alt="Projeto Cas4 Ampliado" class="max-w-full max-h-[75vh] object-contain rounded-lg shadow-2xl transition-opacity duration-300 opacity-0" />
    </div>

    <div class="mt-6 mb-4 max-w-3xl text-center px-4">
      <p id="lightbox-caption" class="text-white text-sm md:text-lg font-medium tracking-wide drop-shadow-md"></p>
    </div>

  </div>
</dialog>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const dialog = document.getElementById('image-lightbox') as HTMLDialogElement;
    const triggers = document.querySelectorAll('.gallery-trigger');
    const img = document.getElementById('lightbox-img') as HTMLImageElement;
    const caption = document.getElementById('lightbox-caption');
    const closeBtn = document.getElementById('close-lightbox');

    // Função para abrir o modal
    const openLightbox = (imageSrc, captionText) => {
      // Impede o scroll da página de fundo
      document.body.style.overflow = 'hidden';
      
      img.src = imageSrc;
      caption.textContent = captionText;
      
      dialog.showModal();
      
      // Efeito de fade-in na imagem após carregar
      img.onload = () => {
        img.classList.remove('opacity-0');
        img.classList.add('opacity-100');
      };
    };

    // Função para fechar o modal
    const closeLightbox = () => {
      document.body.style.overflow = '';
      img.classList.remove('opacity-100');
      img.classList.add('opacity-0');
      
      setTimeout(() => {
        dialog.close();
        img.src = '';
      }, 200); // Aguarda a animação antes de limpar
    };

    // Adiciona o evento de clique em cada imagem da galeria
    triggers.forEach(trigger => {
      trigger.addEventListener('click', () => {
        const src = trigger.getAttribute('data-src');
        const text = trigger.getAttribute('data-caption');
        openLightbox(src, text);
      });
    });

    // Fecha ao clicar no botão X
    closeBtn.addEventListener('click', closeLightbox);

    // Fecha ao clicar fora da imagem (no fundo escuro)
    dialog.addEventListener('click', (e) => {
      if (e.target === dialog || e.target === dialog.firstElementChild) {
        closeLightbox();
      }
    });

    // Fecha com a tecla ESC (acessibilidade)
    dialog.addEventListener('cancel', () => {
      closeLightbox();
    });
  });
</script>

<style>
  /* Corrige o comportamento padrão do dialog em alguns navegadores mobile */
  dialog::backdrop {
    background-color: rgba(5, 24, 48, 0.95);
    backdrop-filter: blur(4px);
  }
</style>